<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SekawanURL | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #064e57; /* Teal Gelap */
            --accent-teal: #14b8a6; /* Teal Terang */
        }
        body { background-color: #f1f5f9; }
        .header-curve {
            background-color: var(--primary-dark);
            border-bottom-left-radius: 60px;
            border-bottom-right-radius: 60px;
        }
        .card-sekawan {
            border-radius: 40px;
            background: white;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="antialiased">

    <header class="header-curve px-8 pt-12 pb-24 text-white">
        <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-md">
                <i class="fa-solid fa-link text-white"></i>
            </div>
            <h1 class="text-2xl font-black italic tracking-tighter">SekawanURL</h1>
        </div>
        <p class="text-teal-100 text-sm opacity-80">Link pendek, urusan kelar.</p>
    </header>

    <main class="max-w-md mx-auto px-4 -mt-16">
        <section class="card-sekawan p-8 mb-8 border border-white">
            <h3 class="text-[10px] font-black text-teal-800 uppercase tracking-[0.2em] mb-6">Create New Link</h3>
            
            <div class="space-y-4">
                <div class="bg-slate-100 rounded-2xl p-4">
                    <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">URL Panjang</label>
                    <input type="text" id="longUrl" placeholder="https://..." 
                           class="w-full bg-transparent outline-none text-slate-700 font-bold">
                </div>

                <div class="bg-slate-100 rounded-2xl p-4">
                    <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Custom Slug</label>
                    <input type="text" id="slug" placeholder="misal: promo-kopi" 
                           class="w-full bg-transparent outline-none text-teal-700 font-bold uppercase">
                </div>
                
                <button onclick="createLink()" class="w-full bg-[#064e57] text-white py-5 rounded-[20px] font-black text-xs uppercase tracking-widest shadow-xl shadow-teal-900/20 active:scale-95 transition-all">
                    Shorten Link <i class="fa-solid fa-bolt ml-2 text-teal-400"></i>
                </button>
            </div>
        </section>

        <div class="flex justify-between items-center px-4 mb-4">
            <h3 class="text-[10px] font-black text-teal-900 uppercase tracking-widest">History</h3>
            <span id="total-link-badge" class="bg-teal-100 text-teal-800 text-[10px] px-3 py-1 rounded-full font-bold">0 Links</span>
        </div>
        
        <div id="links-list" class="space-y-4">
            <div class="text-center py-10 text-slate-400 text-xs italic">Menunggu perintah...</div>
        </div>
    </main>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, setDoc, collection, onSnapshot, query, orderBy, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Konfigurasi Firebase (Pakai punya kamu yang tadi)
  const firebaseConfig = {
    apiKey: "AIzaSyB2VYtNIg88lJlCivVhWWHv3NVkYm5KQsw",
    authDomain: "link-sekawan.firebaseapp.com",
    projectId: "link-sekawan",
    storageBucket: "link-sekawan.firebasestorage.app",
    messagingSenderId: "328194312526",
    appId: "1:328194312526:web:f0b5ec493e823133ef761f"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // LOGIC TOMBOL SHORTEN
  window.createLink = async () => {
    const longUrl = document.getElementById('longUrl').value;
    const slug = document.getElementById('slug').value.trim().toLowerCase();

    if (!longUrl || !slug) {
      alert("Waduh, isi dulu link sama slug-nya bos!");
      return;
    }

    try {
      await setDoc(doc(db, "links", slug), {
        originalUrl: longUrl,
        slug: slug,
        clickCount: 0,
        createdAt: new Date()
      });
      
      // Reset input biar bersih
      document.getElementById('longUrl').value = '';
      document.getElementById('slug').value = '';
      alert("Mantap! Link /" + slug + " berhasil dibuat.");
    } catch (e) {
      console.error("Gagal simpan:", e);
      alert("Gagal: " + e.message);
    }
  };

  // RENDER LIST SECARA REAL-TIME
  const listContainer = document.getElementById('links-list');
  const q = query(collection(db, "links"), orderBy("createdAt", "desc"));

  onSnapshot(q, (snapshot) => {
    listContainer.innerHTML = '';
    document.getElementById('total-link-badge').innerText = `${snapshot.size} Links`;
    
    snapshot.forEach((doc) => {
      const data = doc.data();
      const card = `
        <div class="card-sekawan p-6 border border-slate-100 mb-4 animate-fade-in">
            <div class="mb-4">
                <p class="text-[10px] font-black text-teal-800 uppercase mb-1">Short link</p>
                <p class="text-teal-600 font-bold underline text-sm truncate">link-sekawan.web.app/${data.slug}</p>
            </div>
            <div class="flex justify-between items-end border-t border-slate-50 pt-4">
                <div class="overflow-hidden pr-4">
                   <p class="text-slate-400 text-[10px] uppercase font-black mb-1">Original URL</p>
                   <p class="text-slate-500 text-[11px] truncate max-w-[180px]">${data.originalUrl}</p>
                </div>
                <div class="text-right flex flex-col items-end gap-2">
                    <p class="text-slate-700 text-[10px] font-black uppercase">Click: ${data.clickCount || 0}</p>
                    <div class="flex gap-2">
                        <button onclick="deleteLink('${data.slug}')" class="text-slate-300 hover:text-red-500 transition"><i class="fa-solid fa-trash-can text-sm"></i></button>
                        <button onclick="copyToClipboard('link-sekawan.web.app/${data.slug}')" class="text-teal-500 hover:scale-110 transition"><i class="fa-solid fa-copy text-sm"></i></button>
                    </div>
                </div>
            </div>
        </div>
      `;
      listContainer.innerHTML += card;
    });
  });

  // FUNGSI COPY & DELETE
  window.deleteLink = async (slug) => {
    if(confirm('Hapus link ini?')) await deleteDoc(doc(db, "links", slug));
  };

  window.copyToClipboard = (text) => {
    navigator.clipboard.writeText(text);
    alert('Link disalin!');
  };
      </script>
    
    </body>
</html>
